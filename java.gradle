buildscript {
    ext {
    }
    repositories {
        mavenLocal()
        maven {
            url 'http://creditcloud.com:8081/nexus/content/groups/public'
            credentials {
                username "jenkins"
                password "hudson"
            }
        }
    }

}

allprojects {
    repositories {
        mavenLocal()
        maven {
            url 'http://creditcloud.com:8081/nexus/content/groups/public'
            credentials {
                username "jenkins"
                password "hudson"
            }
        }
    }

    apply plugin: 'java'
    apply plugin: 'maven-publish'
    apply plugin: 'maven'
    apply plugin: 'java-library'

    //打包源代码
    task packageSources(type: Jar, dependsOn: 'classes') {
        classifier = 'sources'
        from sourceSets.main.allSource
    }
    artifacts {
        archives packageSources
    }
    
    //上传到nexus
    def userName = System.getProperty("userName")
    def password = System.getProperty("password")
    def url = System.getProperty("url")?:"http://creditcloud.com:8081/nexus/content/repositories/releases"
    uploadArchives {
        repositories {
            mavenDeployer {
                repository(url: "$url") {
                    authentication(userName: "$userName", password: "$password")
                }
                pom.version = "$project.version"
                pom.artifactId = "$project.name"
                pom.groupId = "$project.group"
            }
        }
    }


    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
                versionMapping {
                    usage('java-api') {
                        fromResolutionOf('runtimeClasspath')
                    }
                    usage('java-runtime') {
                        fromResolutionResult()
                    }
                }
            }
        }
    }
}


subprojects {
    sourceCompatibility = 11
    targetCompatibility = 11
}